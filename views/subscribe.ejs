<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Import CSS Bootstrap -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <!-- Import custom CSS -->
        <link rel="stylesheet" type="text/css" href="/css/style-product.css">
        <link rel="stylesheet" type="text/css" href="/css/style-navbar.css">
        <title>Hub principal du site</title>
    </head>
 
    <body>
    	<header>
            <% include navbar %>
        </header>

        <main class="bg-light py-5">
            <div class="jumbotron bg-light m-0 w-100 text-center">
                <a class="logo-img" href="/mainpage">
                    <img class="col-md-6" src="/img/logo1.png">
                </a>
            </div>
			<form action="/sign-up" method="post" class="subscribe-pannel container">
				<div class="row">
					<div class="col-lg-4 col-md-6">
						<h3 class="border-bottom mb-3 pb-2"> Détails personnels </h3>
						<div class="form-group form-row">
		                    <input type="text" placeholder="Nom et prénom" class="form-control" name="name">
		                    <div class="invalid-feedback">Veuillez rentrer un nom valide</div>
		                </div>
		                <div class="form-group form-row">
		                    <input type="text" placeholder="Adresse email" class="form-control" name="email">
		                    <div class="invalid-feedback">Veuillez rentrer une adresse email valide</div>
		                </div>
		                <div class="form-group form-row">
		                	<input type="tel" placeholder="Téléphone (mobile de préférence)" class="form-control" name="tel">
        					<div class="invalid-feedback">Veuillez rentrer un numéro valide valide</div>
        				</div>
	            	</div>
	            	<div class="col-lg-4 col-md-6">
	            		<h3 class="border-bottom mb-3 pb-2"> Adresse </h3>
		                <div class="form-group form-row">
		                    <input type="text" placeholder="Adresse" class="form-control" name="adresse">
		                    <div class="invalid-feedback">Veuillez rentrer une adresse valide</div>
		                </div>
		                <div class="form-group form-row">
		                    <input type="text" placeholder="Code postal / Ville" class="form-control" name="city">
		                    <div class="invalid-feedback">Veuillez rentrer une ville valide</div>
		                </div>
		                <div class="form-group form-row">
		                    <input type="text" placeholder="Pays" class="form-control" name="country">
		                    <div class="invalid-feedback">Veuillez rentrer un pays valide</div>
		                </div>
	            	</div>
	            	<div class="col-lg-4 col-md-6">
	            		<h3 class="border-bottom mb-3 pb-2"> Mot de passe </h3>
		                <div class="form-group form-row">
		                    <input type="password" placeholder="Mot de passe" class="form-control" name="password">
		                    <div class="invalid-feedback">Veuillez rentrer un mot de passe valide</div>
		                </div>
		                <div class="form-group form-row">
		                    <input type="password" placeholder="Répetez le mot de passe" class="form-control" name="repeat-password">
		                    <div class="invalid-feedback">les mots de passe ne correspondent pas</div>
		                </div>
		            </div>
	        	</div>
	        	<div class="row mt-5 mx-2">
	                <div class="form-check w-100">
	                    <input class="form-check-input" type="checkbox" id="subscribeNewsletter" name="newsletter" value="yes">
	                    <label for="subscribeNewsletter">Je souhaite m'abonner à la newsletter</label>
	                </div>
	                <div class="form-check w-100">
	                    <input class="form-check-input" type="checkbox" id="subscribeCgu" name="cgu" value="yes">
	                    <label for="subscribeCgu">J'ai lu et accepte les conditions d'utilisation</label>
	                    <div class="invalid-feedback">Vous devez accepter les CGU pour vous inscrire</div>
	                </div>
                    <button type="submit" class="btn btn-primary mt-3" data-dismiss="">S'inscrire</button>
	            </div>
            </form>
        </main>
    </body>

	<script type="text/javascript">
	    /* Erreur à afficher pour le login */
	    $('form[action="/sign-up"]').submit(function () {
	    	var nameInput = $('.subscribe-pannel input[name="name"]');
	        var emailInput = $('.subscribe-pannel input[name="email"]');
	        var adresseInput = $('.subscribe-pannel input[name="adresse"]');
	        var cityInput = $('.subscribe-pannel input[name="city"]');
	        var countryInput = $('.subscribe-pannel input[name="country"]');
	        var passwordInput = $('.subscribe-pannel input[name="password"]');
	        var repeatpasswordInput = $('.subscribe-pannel input[name="repeat-password"]');
	        var newsletterInput = $('.subscribe-pannel input[name="newsletter"]:checked');
	        var cguInput = $('.subscribe-pannel input[name="cgu"]:checked');
	        var telInput = $('.subscribe-pannel input[name="tel"]');
    		var regex = new RegExp("[0-9]{10}");

	        // On check les erreurs et on ajoute la classe en consequant
	        if (!nameInput.val()) {
	            nameInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            nameInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!emailInput.val()) {
	            emailInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            emailInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!telInput.val()) {
	            telInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else if (!telInput.val().match(regex)) {
	            telInput.removeClass('is-valid').addClass('is-invalid');
	        }
	        else {
	            telInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!adresseInput.val()) {
	            adresseInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            adresseInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!cityInput.val()) {
	            cityInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            cityInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!countryInput.val()) {
	            countryInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            countryInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!passwordInput.val()) {
	            passwordInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            passwordInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!repeatpasswordInput.val()) {
	            repeatpasswordInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else if (repeatpasswordInput.val() != passwordInput.val()) {
	            repeatpasswordInput.removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	        	repeatpasswordInput.removeClass('is-invalid').addClass('is-valid');
	        }
	        if (!cguInput.val()) {
	            $('.subscribe-pannel input[name="cgu"]').removeClass('is-valid').addClass('is-invalid');
	            return false;
	        } else {
	            $('.subscribe-pannel input[name="cgu"]').removeClass('is-invalid').addClass('is-valid');
	        }

	        $.post("/sign-up", {
	        	name: nameInput.val(),
	            email: emailInput.val(),
	            adress: adresseInput.val(),
	            city: cityInput.val(),
	            country: countryInput.val(),
	            password: passwordInput.val(),
	            newsletter: newsletterInput.val()
	        })
	        .done( function (data) {
	            if (data == "badEmail") {
	                emailInput.removeClass('is-valid').addClass('is-invalid'); // l'email est déjà utilisé
	                $('header').append(
	                	`<div class="notif-container row w-100 justify-content-center">
				            <div class="alert alert-danger alert-dismissible fade show col-8" role="alert">
				                <strong>Erreur !</strong> L'email est déjà utilisé par un autre compte ...
				                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
				                    <span aria-hidden="true">&times;</span>
				                </button>
				            </div>
				            <div class="w-100"></div>
				        </div>`
	                	)
	            }
	            else {
	                location.reload();
	            }
	        });

	        return false; // on execute pas le submit normal
	         
	    });
	</script>
</html>